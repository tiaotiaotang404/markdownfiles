## 第一章 数字滤波器及FPGA概述

​		数字滤波器（Digital Filter，DF），通常定义为通过对数字信号的运算处理，改变信号的频谱，完成滤波作用的算法或装置。

​		现场可编程门阵列（Field Programmable Gate Array，FPGA）因其良好的并行运算能力，以及无与伦比的可重配置性，可扩展性能，已经成为现代电子设备中不可或缺的组成部分，尤其在数字滤波器设计等数字信号处理领域中得到十分广泛的应用。

### 1.1滤波器概述

#### 1.1.1滤波器简介

​		滤波器是一种用来减少或消除干扰的电气部件，其功能是对输入信号进行过滤处理得到所需的信号。滤波器最常见的用法是对特定频率的频点或该频点以外的频率信号进行有效滤除，从而实现消除干扰、获取某个特定频率信号的功能。

​		随着数字信号处理理论的成熟、实现方法的不断改进，以及数字信号处理器件性能的不断提高，数字滤波器技术的应用也越来越广泛。与模拟滤波器相比，数字滤波器主要特点如下：

1. 数字滤波器是一个离散时间系统

​		应用数字滤波器处理模拟信号时，首先要对输入模拟信号进行限带、抽样和模/数转换。数字滤波器输入信号的抽样频率应大于被处理信号带宽的2倍，其频率响应具有以抽样频率为间隔的周期重复特性。为得到模拟信号，数字滤波器处理的输出数字信号须经数/模转换和平滑处理。

2. 数字滤波器的工作方式与模拟滤波器完全不同

​		模拟滤波器完全依靠电阻、电容、晶体管等电子元件组成的物理网络实现滤波功能；数字滤波器则是通过数字运算器件对输入的数字信号进行运算和处理，从而实现设计要求的特性。

3. 数字滤波器具有比模拟滤波器更高的精度

​		数字滤波器甚至可以实现模拟滤波器在理论上也无法达到的性能。例如，对于数字滤波器来说很容易做到一个1000Hz的低通滤波器，该滤波器允许999Hz信号通过并且完全阻止1001Hz的信号，模拟滤波器却无法区分如此接近的信号。

4. 数字滤波器具有比模拟滤波器更高的信噪比

​		因为数字滤波器是以数字器件执行运算的，从而避免了模拟电路中噪声的影响。数字滤波器中的主要噪声源是在数字系统之前的模拟电路引入的电路噪声，以及在数字系统输入端的模/数转换过程中产生的量化噪声。这些噪声在数字系统的运算中可能会被放大，因此在设计数字滤波器时需要采用合适的结构，以降低输入噪声对系统性能的影响。

5. 数字滤波器具有模拟滤波器无法比拟的可靠性

​		组成模拟滤波器的电阻元件的电路会随着时间、温度、电压的变化而漂移，而数字电路就没有这种问题。

6. 数字滤波器的处理能力受到系统抽样频率的限制

​		根据奈奎斯特采样定理，如果输入信号的频率分量包含超过滤波器的1/2倍抽样频率的分量时，数字滤波器就会因为频谱混叠而无法正常工作。

7. 数字滤波器与模拟滤波器的使用方式不同

​		使用模拟滤波器通常直接购买满足性能的滤波器件即可。采用数字滤波器时通常需要自己编写代码，或使用可编程逻辑器件搭建所需性能的滤波模块，相较模拟滤波器的使用较为麻烦，但换来的是设计的灵活性，高可靠性，可扩展性等一系列优势。

#### 1.1.2 数字滤波器的分类

​		较通用的分类方法是将数字滤波器分为两大类，即经典滤波器和现代滤波器。

​		经典滤波器假定输入信号x(n)中的有效信号和噪声信号分布在不同的频带，当x(n)通过一个线性滤波系统后，可以将噪声信号成分有效的减少或去除。如果有效信号和噪声信号的频带相互重叠，那么经典的滤波器将无能为力。

​		现代滤波器把信号和噪声都视为随机信号，利用它们的统计特征（如自相关函数、功率谱函数等）推导出一套最佳的估值算法，然后用硬件或软件实现。

​		从实现的网络结构或单位脉冲响应来看，数字滤波器可以分为无限脉冲响应（IIR）滤波器和有限脉冲响应（FIR）滤波器，二者的根本区别在于两者的系统函数结构不同。

![image-20230607103752208](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230607103752208.png)

![image-20230607103801982](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230607103801982.png)

​		1-1是FIR滤波器的系统函数，1-2是IIR滤波器的系统函数。

​		FIR滤波器与IIR滤波器的系统函数的特点决定了它们具有不同的实现结构及特点：FIR滤波器不存在输出对输入的反馈结构，IIR滤波器存在输出对输入的反馈；FIR具有严格的线性相位特性，IIR滤波器无法实现线性相位特性，且其频率选择性越好的非线性越严重。

#### 1.1.3 滤波器的特征参数

​		对于经典滤波器的设计来说，理想的情况是完全滤除干扰频带的信号，同时有用频带信号不发生任何衰减或畸变。也就是说滤波器的形状在频域呈矩形，而在频域上呈矩形的滤波器转换到时域后就变成了一个非因果系统，物理上是无法实现的，因此，工程上只能尽量设计一个可实现的滤波器，并尽可能的逼近理想滤波器性能。

![image-20230607104730015](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230607104730015.png)

​		低通滤波器的通带截止频率为w<sub>p</sub>，通带容限为α<sub>1</sub>，阻带截止频率为w<sub>s</sub>，阻带容限为α<sub>2</sub>。通带定义为|w|≤w<sub>p</sub>，1-α<sub>1</sub>≤|H(e<sup>jw</sup>)|≤1；阻带定义为w<sub>s</sub>≤|w|≤pi，|H(e<sup>jw</sup>)|≤α<sub>2</sub>；过渡带定义为w<sub>p</sub>≤w≤w<sub>s</sub>。通带内和阻带内允许的衰减一般用dB来表示，通带内允许的最大衰减用α<sub>p</sub>表示，阻带内允许的最小衰减用α<sub>s</sub>表示，α<sub>p</sub>和α<sub>s</sub>分别定义为：

![image-20230607110719441](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230607110719441.png)

![image-20230607110803256](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230607110803256.png)

### 1.2 FPGA基本知识

#### 1.2.1 FPGA基本概念及发展历程

#### 1.2.2 FPGA的结构和工作原理

1. FPGA的结构

​		通常将以乘积项结构方式构成逻辑行为的器件称为CPLD，这类器件更适合触发器有限而乘积项丰富的结构，适合完成复杂的组合逻辑。通常将基于查找表结构的PLD器件称为FPGA，更适合触发器丰富的结构，适合完成时序逻辑，因此在数字信号处理领域多使用FPGA器件。

​		FPGA主要有六部分组成，分为可编程输入/输出单元（Input/Output Block，IOB）、可配置逻辑块（CLB）、数字时钟管理模块（DCM）、嵌入式块RAM（BRAM）、丰富的布线资源和内嵌专用硬核。FPGA内部结构示意图如下：

![image-20230607135517807](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230607135517807.png)



1. FPGA的工作原理

#### 1.2.3 IP核的概念

### 1.3 FPGA在数字信号处理中的应用

## 第二章 设计语言及环境介绍

### 2.1 Verilog HDL语言简介

### 2.2 FPGA 开发工具及设计流程

#### 2.2.1 Quartus II

#### 2.2.2 ModelSim 

#### 2.2.3 FPGA设计流程

![image-20230607143505347](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230607143505347.png)

### 2.3 MATLAB软件

### 2.4 MATLAB与Quartus II的联合应用

## 第三章 FPGA实现数字信号处理基础

​		数字信号是指时间和幅度均是离散的信号。时间离散是指信号在时间上的不连续性，且通常是等间隔信号；幅度离散是指信号的幅度值只能取某个区间上的有限值，而不能取区间上的任意值。

### 3.1 数的表示

#### 3.1.2 定点数表示法

1. 定点数的定义

​		为了与十进制小数点相区别，使用三角符号&triangle;来表示二进制的小数点位置。例如，十进制数11.625可表示为二进制数1011&triangle;101。对于任意一个二进制数来讲，均可由B个整数位和b个小数位组成，

![image-20230607181659609](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230607181659609.png)

其对应的十进制数大小D由

![image-20230607181745631](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230607181745631.png)

给出。其中，a<sub>i</sub>的值均为1或0。

​		定点数是指小数点在数中的位置是固定不变的二进制数。如果用N个比特表示正小数η，则小数η范围为

![image-20230607182017521](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230607182017521.png)

在给N的情况下，小数η的范围是固定的。

​		在数字处理中，定点数通常把数限制在-1~1之间，把小数点规定在符号位和数据位之间，而把整数位作为符号位，分别用0、1来表示正、负，数的本身只有小数部分，即尾数。这是由于经过定点数的乘法后，所得结果的小数点位置是不确定的，除非两个乘数都是小数或 整数。对于加法运算来说，小数点的位置是固定的。这样，定点数x可表示为

![image-20230607182723578](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230607182723578.png)

式中，a<sub>B-1</sub>为符号位，B为数据的位数，表示寄存器的长度为B位。定点数在整个运算过程中，要求所有运算结果的绝对值不超过1，否则会出现溢出。但在实际问题中，运算的中间变量或结果有可能超过1，为使运算正确，通常对运算过程中的各数乘以一个比例因子，以避免溢出现象的发生。

2. 定点数的三种表示方法

​		1）原码表示法

​		原码表示法是指符号位加绝对值的表示法。符号位通常用0表示正号，用1表示负号。若已知原码各位的值，则它对应的十进制可表示为

![image-20230608091755906](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230608091755906.png)

 		若已知绝对值小于1的十进制数，可以借用MATLAB提供的十进制整数转二进制函数dec2bin进行转换。

​		2）反码表示法

​		正数的反码与原码相同，负数的反码是将原码除符号位外的所有位取反。

​		3）补码表示法

​		正数的补码、反码和原码完全相同，负数的补码等于反码加一。

​		原码的优点是乘除法运算方便，无论正负数，乘除法运算都一样，并以符号位决定结果的正负；若做加法，则需要判断两个数符号是否相同；若做减法，还需要判断两个数绝对值的大小，而后用大数减小数。补码的优点是加法运算方便，无论正负数均可直接加，且符号位同样参与运算，如果符号位发生进位，则把进位的1去掉，余下的即结果。

#### 3.1.3 浮点表示法

1. 浮点数的定义及标准

2. 单精度浮点数格式

​		在IEEE754中规定了4种浮点数的表示格式：单精度（32位浮点数）、双精度（64位浮点数）、单精度扩展（≥43位，不常用）、双精度扩展（≥79位，通常采用80位进行实现）。

​		单精度浮点数格式如下图所示：

![image-20230608094059369](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230608094059369.png)

​		符号位S占1bit，0代表正号，1代表负号；指数位E占8bit，其取值范围为0~255（无符号整数），实际数值e=E-127，有时E也称为移码；尾数位M占23bit，M也称为有效数字位、系数位。一般m=(1.M)<sub>2</sub>，使得实际的作用范围为1≤尾数<2。为了对溢出进行处理，以及扩展对接近0的极小数值的处理能力，对M做了一些额外规定。

- 0值：以指数E、尾数M全零来表示0值。当指数位S变化时，实际存在正0和负0两个内部表示，其值认为都等于0。
- E=255、M=0时，用作无穷大，根据符号不同，又有+∞、-∞。
- NaN：E=255、M不为0时，用作NaN（Not a Number）。

浮点数所表示的具体值可用下面通式表示，即

![image-20230608095734758](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230608095734758.png)

其中，尾数（1.M）中的1为隐藏位。

几个常用的浮点数与实数之间的对应关系如下表：

![image-20230608101221212](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230608101221212.png)

3. 一种适合FPGA处理的浮点数格式

​		公式与格式如下图所示：

![image-20230608101840639](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230608101840639.png)

![image-20230608101850257](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230608101850257.png)

​		规定数值1的表示方法为指数0，尾数01_1111_1111_1111_1111，数值0的表示方法为指数为-128，尾数为0。自定义的浮点数格式将原来的符号位与尾数位合成18位补码格式的定点数，表示精度有所下降，却可大大节省乘法器资源，并有效地减少运算步骤以及提高运算速度。

![image-20230608102618962](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230608102618962.png)

3.2 FPGA中数的运算

​		浮点数的基本运算是通过将浮点数分解位定点数运算以及移位等运算步骤来实现的。故只讨论定点数的运算，下面介绍Verilog HDL中对于定点数的运算及处理方法。

![image-20230608174047458](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230608174047458.png)

![image-20230608174454283](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230608174454283.png)

### 3.3 有限字长效应

​		有限字长的数就是有限精度的数。数字系统中主要有三种由于有限字长而引起误差的因素：

- 模/数转换把模拟输入信号转换成一组离散电平时产生的量化效应
- 用有限二进制数表示系数时产生的量化效应
- 在数字运算过程中，为限制位数进行的尾数处理和为防止溢出而压缩信号电平的有限字长效应

​		引起这些误差的根本原因在于寄存器（存储单元）的字长有限。误差的特性与系统的类型、结构形式、数字的表示法、运算方式及字的长短有关。

## 第四章 FIR滤波器的FPGA实现

### 4.1 FIR滤波器的理论基础

#### 4.1.1 线性时不变系统

​		满足叠加原理的一类系统。

#### 4.1.2 FIR滤波器的原理

​		FIR滤波器，即有限脉冲响应滤波器，指单位脉冲响应的长度是有限的滤波器。具体来说，FIR滤波器的突出特点是其单位取样响应h(n)是一个N点长的有限长序列，0≤n≤N-1。滤波器的输出y(n)可表示为输入序列x(n)与单位取样响应h(n)的线性卷积。

![image-20230608182645994](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230608182645994.png)

系统函数为：

![image-20230608182704890](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230608182704890.png)

#### 4.1.3 FIR滤波器的特性

1. 相位特性

​		当FIR滤波器单位取样响应h(n)满足对称条件时，FIR滤波器才具有线性相位特性。

2. 幅度特性

![image-20230608183341082](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230608183341082.png)

#### 4.1.4 FIR滤波器的结构形式

1. 滤波器结构的表示方法

​		方框图法和信号流图法。

![image-20230609083903739](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230609083903739.png)

2. 直接型

​		FIR滤波器的直接型结构（假设滤波器的单位取样响应为M+1点长的有限序列）：

![image-20230609085632997](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230609085632997.png)

​		对于M+1阶FIR滤波器，需要M+1个乘法运算、M个延时单元，以及1个M+1输入的加法运算。

3. 级联型

​		耗费资源较多，一般不采用。

4. 频率取样型

​		结构图如下：

![image-20230609090630144](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230609090630144.png)

​		相对于前两种结构来说，频率取样型结构比较复杂，在某些特殊的情况下，这种结构会有明显的优势。

5. 快速卷积型

​		又称为FFT型结构，FIR滤波器的突出特点是输出可表示为输入与系统单位取样响应的线性卷积。如果输入序列为M点，0≤n≤M-1，只要选择L≥N+M-1，则L点循环卷积就可以代表线性卷积。得出快速卷积型结构如下：

![image-20230609091720363](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230609091720363.png)

​		快速卷积型结构实际上是用快速傅里叶变换算法实现FIR滤波器。

### 4.2 FIR滤波器的设计方法

#### 4.2.1 窗函数法

​		基本思路是先给出要求的理想滤波器频率响应H<sub>d</sub>(e<sup>jw</sup>)，然后设计一个FIR滤波器频率响应H(e<sup>jw</sup>)去逼近H<sub>d</sub>(e<sup>jw</sup>)。由于窗函数法是时域进行的，故首先需要由理想频率响应推导出对应的单位取样响应h<sub>d</sub>(n)，再设计一个FIR滤波器的单位取样响应h(n)去逼近h<sub>d</sub>(n)。

​		假定设计一个截止频率为w<sub>c</sub>的低通滤波器，要求滤波器是线性相位，其幅度特性如图，易推导出该理想滤波器的单位取样响应。

![image-20230608185227935](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230608185227935.png)

​		理想滤波器的单位取样响应如图所示。由于H<sub>d</sub>(e<sup>jw</sup>)是矩形特性，因此h<sub>d</sub>(n)必然既是无限长的，又是非因果的。而需要设计的FIR滤波器，要求其单位取样响应h(n)是有限长的，且是因果的。因此，需要用有限长的h(n)去逼近无限长的h<sub>d</sub>(n)，并且要求h(n)具有因果特性。

​		最简单的办法是直接截短h<sub>d</sub>(n)，使h(n)与h<sub>d</sub>(n)之间的关系为

![image-20230608202154864](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230608202154864.png)

这个截短的过程可以认为无限长的取样响应与有限长的窗函数w(n)的乘积，这种简单的截短不能得到因果的h(n)。

![image-20230608202410165](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230608202410165.png)

​		非因果系统是无法在实际中实现的，因此必须将非因果的h(n)换成因果的h(n)才可以。将截短的响应向右平移(N-1)/2的抽样点，即可将所有的n值小于0的点移至n>0，即为因果系统。

​		因此，因果FIR滤波器的截取过程可表述为：设计一个具有群延迟特性为(N-1)/2的理想低通滤波器，使用窗函数法对理想滤波器的单位取样响应进行截取，截取的范围为0≤n≤N-1，形成N阶FIR滤波器。

​		时域相乘，频域卷积。加窗卷积后对理想滤波器的特性主要有以下几点影响：

- H<sub>d</sub>(w)在截止频率处的间断点变成了连续曲线，使实际FIR滤波器的幅频特性出现一个过渡带，其宽度等于窗函数W<sub>R</sub>(w)的主瓣宽度；
- 由于窗函数旁瓣的作用，使幅频特性出现了波动，波动幅度取决于旁瓣的相对幅度，旁瓣范围的面积越大，通带波动和阻带波动就越大；
- 增加窗函数的长度，只能减少W<sub>R</sub>(w)的主瓣宽度，而不能改变旁瓣与主瓣的相对值，该值取决于窗函数的形状。

​		因此只能通过改变窗函数的形状来改善FIR滤波器的幅频特性，窗函数选择原则如下：

- 具有较低的旁瓣幅度，尤其是第一旁瓣幅度；
- 旁瓣幅度下降速率要大，以利于增加阻带衰减；
- 主瓣的宽度要窄，以获得较陡的过渡带。

#### 4.2.2 频率取样法

​		窗函数法是从时域出发设计FIR滤波器的。一个有限长序列，在满足频率抽取定理的条件下，可以通过对频谱的有限个抽样值准确地恢复原序列。采用频率抽样法设计FIR滤波器就是从频域出发，根据频域抽样定理，对给定的理想频率响应H<sub>d</sub>(e<sup>jw</sup>)进行等间隔抽样。

![image-20230608211412743](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230608211412743.png)

把H<sub>d</sub>(k)当成待设计的FIR滤波器的频率特性抽样值H(k)，再由H(k)进行IDFT即可得到有限长序列h(n)，即

![image-20230608211559484](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230608211559484.png)

将上式进行z变换，得到系统的z变换及频率响应，即

![image-20230608211730115](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230608211730115.png)

式中，&psi;(w)为内插函数，即

![image-20230608212917196](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230608212917196.png)

​		如果抽样点之间的理想特性越平缓，则内插值就越接近理想值，逼近就越好。相反地，如果抽样点之间的理想特性变换越激烈，则内插值与理想值的误差就越大，因而在理想特性的每个不连续点会出现肩峰和起伏，不连续性越大，肩峰和起伏就越大。因此，这种方法在工程中使用较少。

#### 4.2.3 最优设计方法

​		窗函数法不容易设计预先给定截止频率的滤波器，也未能接近在给定阶数N值时，怎样设计一个最佳FIR滤波器的问题。频率取样法是一种优化设计，但由于赖以进行优化设计的变量只限于过渡带上几个抽样值，故不是最优化的设计。

​		从FIR滤波器的系统函数可以看出，极点都在Z平面的原点，不同的零点分布对应不同的频率响应。最优设计实际就是调节这些零点分布位置，使实际频率响应H(e<sup>jw</sup>)与理想频率响应H<sub>d</sub>(e<sup>jw</sup>)间的绝对偏差最小。

​		最优设计方法——**等纹切比雪夫逼近法**，采用“最大误差最小”准则得到最佳滤波器，且最佳解是唯一的。

### 4.3 FIR滤波器的MATLAB设计

#### 4.3.1 采用firl函数设计

#### 4.3.2 采用kaiserord函数设计

#### 4.3.3 采用fir2函数设计

#### 4.3.4 采用firpm函数设计

#### 4.3.5 采用FDATOOL设计滤波器

### 4.4 FIR滤波器的FPGA实现

#### 4.4.1 滤波器系数的量化

#### 4.4.2 串行FIR滤波器的FPGA实现

​		根据直接型的结构可知，滤波器实际上就是一个乘累加运算，且乘累加运算的次数由滤波器的阶数决定。所谓串行结构，即串行实现滤波器的累加运算，将每级延时单元与相应系数的乘积结果进行累加后输出，因此，整个滤波器实际上只需要一个乘法器单元。串行结构可以分为全串行结构和半串行结构，全串行结构是指进行对称系数的加法运算由一个加法器串行实现，半串行结构则指用多个加法器同时实现对称系数的加法运算。

![image-20230609095538891](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230609095538891.png)

​		两种结构的区别在于实现对称系数的加法运算实现方式。全串行结构使用的加法器资源更少。

#### 4.4.3 并行FIR滤波器的FPGA实现

​		所谓并行结构，是指并行地实现滤波器的累加运算，具体来讲，就是并行地将具有对称系数的输入数据进行相加，然后采用多个乘法器并行地实现系数与数据的乘法运算，最后将所有乘法结果相加输出。虽然并行结构可以提高系统的运行速度，但因此需要使用成倍的硬件资源。

![image-20230609100333777](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230609100333777.png)

#### 4.4.4 分布式FIR滤波器的FPGA实现

​		分布式算法是一种专门针对乘加运算的运算方法，在完成乘加运算时通过将各输入数据的每一位对应位产生的运算结果预先进行相加，形成相应的部分积，再对各部分进行累加形成最终结果；而传统算法则是在所有乘积结果产生之后再进行相加，从而完成整个乘加运算的。

#### 4.4.5 采用IP核实现

## 第五章 IIR滤波器的FPGA实现

​		无限脉冲响应（IIR）滤波器具有很高的滤波效率，在相同的幅频响应条件下，所要求的IIR滤波器阶数明显比FIR滤波器低。同时，IIR滤波器的设计可以利用模拟滤波器的设计成果。IIR滤波器可以用较少的硬件资源获取较好的幅频特性。IIR滤波器的一个显著特点是不具备严格的线性相位特性，因此相对于FIR滤波器来讲应用范围较窄。

### 5.1 IIR滤波器的理论基础

#### 5.1.1 IIR滤波器的原理及特性

​		IIR滤波器系统函数为

![image-20230609102514136](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230609102514136.png)

​		系统的差分方程可以写成

![image-20230609102550272](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230609102550272.png)

​		从系统函数得出IIR滤波器有以下几个特性：

- IIR滤波器同时存在不为0的极点和零点。系统的稳定性由系统函数极点决定。
- 由于线性相位滤波器所有的零点和极点都是关于单位圆对称的，所以只允许极点位于单位圆的原点。由于IIR滤波器存在不为零的极点，因此只可能实现近似的线性相位特性。
- 在FPGA等数字硬件平台上实现IIR滤波器时，由于存在反馈结构，因此受限于有限的寄存器长度，无法通过增加字长来实现全精度IIR滤波器运算。在IIR滤波器运算过程中，有限字长效应是工程实现时必须要考虑的问题。

#### 5.1.2 IIR滤波器的结构形式

1. 直接I型

​		根据5-2式得出，输出信号由两部分组成，第一部分表示对输入信号进行延时，组成M阶延时网络，相当于FIR滤波器的横向网络，实现系统的零点；第二部分表示对输出信号进行延时，组成N阶延时网络，每阶经延时抽头后与常系数相乘，并将乘法结果相加，由于这部分是对输出的延时，故为反馈网络，实现系统的极点。

![image-20230609135326597](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230609135326597.png)

2. 直接II型

​		式5-1改写为

![image-20230609135412233](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230609135412233.png)

​		即IIR滤波器的系统函数可以看作两部分网络的级联。对于线性时不变系统，交换级联子系统的次序，系统函数不变。根据上式得到结构图如下：

![image-20230609135622792](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230609135622792.png)

​		由于两个串行延时支路具有相同的输入，因而可以合并，得到直接II型结构。

![image-20230609135755620](C:\Users\张云鑫\AppData\Roaming\Typora\typora-user-images\image-20230609135755620.png)

​		对于N阶差分方程，直接II型结构只需N个延时单元（通常N≥M），比直接I型结构的延时单元少一半，因而在软件实现时可以节省存储单元，在硬件实现时可节省寄存器。

3. 级联型

​		FIR滤波器不适合使用级联型结构，原因是这种结构需要使用较多的乘法运算单元。FIR滤波器的阶数一般比较大，且没有反馈网络，因此大多采用直接I型结构实现。IIR滤波器则不同，级联型结构与直接型结构相比，每一个级联部分中反馈网络很少，易于控制有限字长效应带来的影响，且IIR滤波器的阶数一般比较小，与直接型结构相比，级联型具有更大优势，这也是实际应用中多采用级联型结构的原因。

4. 并联型

#### 5.1.3 IIR滤波器与FIR滤波器的比较

- 通常，在满足同样幅频响应设计指标情况下，FIR滤波器阶数是IIR滤波器阶数的5~10倍
- FIR滤波器能得到严格的线性相位特性（当滤波器系数具有对称性时）；IIR滤波器在相同阶数情况下，具有更好的幅频特性，但相位特性是非线性的。
- FIR滤波器的单位脉冲响应是有限长的，一般采用非递归结构，是稳定的系统，即使在有限精度运算时，误差也较小，即受有限字长效应的影响较小；IIR滤波器必须采用递归结构，极点在单位圆内才能稳定，这种具有反馈的结构，由于运算的舍入处理，易引起振荡现象。
- FIR滤波器的运算是一种卷积运算，它可以利用快速傅里叶变换和其他快速算法来实现，运算速度快；IIR滤波器无法采用类似的快速算法。
- 在设计方法上，IIR滤波器可以利用模拟滤波器现成设计公式、数据和表格等资料；FIR滤波器则不能借助模拟滤波器的设计成果。
- 在FPGA设计中，FIR滤波器可以采用现成的IP核进行设计，工作量较小；IIR滤波器可用的IP核较少，一般要手动编写，工作量较大
- 当给定幅频特性且不考虑相位特性时，采用IIR滤波器较好；当要求严格线性相位特性或幅度特性不同于典型模拟滤波器特性时，通常采用FIR滤波器。

### 5.2 IIR滤波器的设计方法

​		实际中多采用直接调用MATLAB的IIR函数进行设计。

### 5.3 IIR滤波器的MATLAB设计

#### 5.3.1 采用butter函数设计滤波器

#### 5.3.2 采用cheby1函数设计滤波器

#### 5.3.3 采用cheby2函数设计滤波器

#### 5.3.4 采用elip函数设计滤波器

#### 5.3.5 采用yulewalk函数设计滤波器

#### 5.3.7 采用FDATOOL设计滤波器

### 5.4 IIR滤波器的FPGA实现



#### 
